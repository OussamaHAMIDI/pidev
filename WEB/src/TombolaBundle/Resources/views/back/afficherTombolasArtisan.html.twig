{% extends '@Souk/layout.html.twig' %}
{% block body %}
    <div class="section" style="padding: 20px;">
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="section-title">
                    <h2 class="title">
                        Mes tombolas
                    </h2>
                </div>
            </div>
        </div>
        <!-- section -->
        <div class="section">
            <!-- container -->
            <div class="container">
                <!-- row -->
                <div class="row">
                    <div class="col-md-11">
                        <div id="container">
                            <div class="col-md-10 col-md-offset-1">
                                <div id="linechart" style="min-width: 400px; height: 400px; margin: 0 auto">
                                    <script src="{{ asset('js/jquery.min.js') }}" type="text/javascript"></script>
                                    <script src="http://code.highcharts.com/4.0.1/highcharts.js"></script>
                                    <script src="http://code.highcharts.com/4.0.1/modules/exporting.js"></script>
                                    <script type="text/javascript">
                                        {{ chart(chart) }}
                                    </script>
                                </div>

                            </div>
                        </div>

                        <div class="pull-right">
                            <div class="row-filter">
                                <form class="navbar-form" role="search">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="keyword" placeholder="Chercher...">
                                        <span class="input-group-btn">
                                        <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                                    </span>
                                    </div>
                                </form>
                            </div>
                        </div>


                        <div class="pull-left" style="padding-left: 60px">
                            <div class="form-group">
                                <a href="{{ path('ajouter_tombola') }}">
                                    <button class="main-btn">Ajouter une nouvelle
                                        tombola
                                    </button>
                                </a>
                            </div>
                        </div>

                        <div class="container" id="result">
                            <div class="col-lg-12">

                                {% if not tombolas is empty %}
                                    <table class="table table-responsive">
                                        <thead>
                                        <tr>
                                            <th rowspan="1">Titre</th>
                                            <th rowspan="1">Description</th>
                                            <th rowspan="1">Date du tirage</th>
                                            <th rowspan="1">Date d'ajout</th>
                                            <th rowspan="1">Date Derniere modification</th>
                                            <th></th>
                                            <th>Opérations</th>
                                            <th></th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for tombola in tombolas %}
                                            <tr>
                                                <td> {{ tombola.titre }} </td>

                                                <td> {{ tombola.description [0:25] }}{% if tombola.description|length > 25 %}...{% endif %}</td>
                                                <td> {{ tombola.dateTirage | date('d-m-Y H:m:s') }} </td>
                                                <td> {{ tombola.dateAjout | date('d-m-Y H:m:s') }} </td>
                                                <td> {{ tombola.dateModif | date('d-m-Y H:m:s') }} </td>

                                                <td>
                                                    <a href="{{ path('details',{id: tombola.id}) }}">
                                                        <button class="btn btn-info"><i class="fa fa-info-circle"></i>
                                                            Détails
                                                        </button>
                                                    </a>
                                                </td>

                                                <td>
                                                    <a href="{{ path('modifier',{id: tombola.id}) }}">
                                                        <button class="btn btn-warning"><i class="fa fa-pencil"></i>
                                                            Modifier
                                                        </button>
                                                    </a>
                                                </td>
                                                <td>
                                                    <button class="btn btn-danger alert_supp"
                                                            href="{{ path('supprimer',{id: tombola.id}) }}">
                                                        <i class="fa fa-trash"></i> Supprimer
                                                    </button>
                                                </td>

                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% else %}

                                {% endif %}

                            </div>
                        </div>


                    </div>


                </div>
                <!-- /row -->
            </div>
            <!-- /container -->
        </div>
        <!-- /section -->


    </div>
    <!-- /container -->


    {% block javascripts %}
        {#<script>#}
        {#Push.create("Hola mundo");#}
        {#</script>#}
        <script>
            $('.alert_supp').confirm({
                title: 'Suppression',
                content: 'Voulez-vous vraiment supprimer cette tombola ?',
                type: 'red',
                typeAnimated: true,
                boxWidth: '300px',
                theme: 'modern',
                draggable: true,
                useBootstrap: true,
                backgroundDismiss: false,
                backgroundDismissAnimation: 'glow',
                buttons: {
                    Oui: {
                        text: 'Oui',
                        btnClass: 'btn-red',
                        action: function () {
                            location.href = this.$target.attr('href');
                        }
                    },
                    Non: {
                        text: 'Non',
                        action: function () {
                        }
                    }
                }
            });
        </script>
        <script>
            var searchField = $('#keyword');
            var tombola_div = $('#result');
            var delay = (function () {
                var timer = 0;
                return function (callback, ms) {
                    clearTimeout(timer);
                    timer = setTimeout(callback, ms);
                };
            })();
            searchField.keyup(function (evt) {

                var array = {'key': searchField.val()};

                delay(function () {
                    $.ajax({
                        url: '{{ path('rechercheAJAX_tombola') }}',
                        method: "POST",
                        data: array,
                        dataType: 'html',
                        success: function (result) {
                            var parsedData = result;
                            tombola_div.fadeOut(function () {
                                tombola_div.empty();
                                tombola_div.html(parsedData).fadeIn();
                            });
                        }
                    });
                }, 100);
            });
        </script>
    {% endblock javascripts %}

{% endblock body %}